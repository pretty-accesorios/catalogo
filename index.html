<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pretty Accesorios ‚ú®</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

    <style>
        /* --- ESTILOS --- */
        :root {
            --primary-color: #8A2BE2; /* Morado fuerte */
            --secondary-color: #DDA0DD; /* Lila suave */
            --bg-color: #F8F8FF;
            --text-color: #000000;
            --card-bg: #FFFFFF;
        }

        body { 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            font-family: 'Montserrat', sans-serif;
            background-image: url('image_5.png'); 
            background-repeat: repeat; 
            background-size: 100px;
            overflow-x: hidden;
        }

        .bg-decoration { position: fixed; z-index: -1; opacity: 0.4; pointer-events: none; }
        h1, h2, h3, h4, h5, .navbar-brand, .category-circle span { font-family: 'Playfair Display', serif; }

        /* NAVBAR & MEN√ö */
        .navbar { background-color: rgba(255, 255, 255, 0.98); border-bottom: 1px solid #eee; padding: 10px 0; }
        .navbar-brand { font-size: 1.2rem; color: var(--text-color) !important; letter-spacing: 1px; font-weight: 700; }
        
        .custom-toggler { 
            background-color: var(--primary-color); border: none; padding: 8px 12px;
            border-radius: 8px; box-shadow: 0 4px 6px rgba(138, 43, 226, 0.3); transition: 0.3s;
        }
        .custom-toggler:active { transform: scale(0.95); }
        .custom-toggler i { color: white; font-size: 1.5rem; }

        /* Men√∫ Lateral */
        .offcanvas { background-color: #fff; width: 300px !important; }
        .nav-link { color: var(--text-color); font-weight: 500; padding: 15px 0; font-size: 1.1rem; border-bottom: 1px solid #f9f9f9; }
        .nav-link:hover { color: var(--primary-color); padding-left: 10px; transition: 0.3s; }

        /* BUSCADOR */
        .search-container { position: relative; width: 140px; }
        .search-input { width: 100%; border: 2px solid var(--secondary-color); border-radius: 20px; padding: 5px 15px; font-size: 0.9rem; outline: none; transition: 0.3s; }
        .search-input:focus { border-color: var(--primary-color); width: 160px; }
        
        /* BOTONES */
        .whatsapp-btn { 
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); 
            color: white !important; border: none; border-radius: 25px; 
            padding: 8px 20px; font-weight: 600; font-size: 0.9rem;
            box-shadow: 0 4px 6px rgba(138, 43, 226, 0.3); transition: all 0.3s; text-decoration: none; display: inline-block;
        }
        .whatsapp-btn:hover { transform: scale(1.05); }

        /* CATEGOR√çAS */
        .category-scroll-container { overflow-x: auto; white-space: nowrap; padding: 20px 10px; background: rgba(255,255,255,0.5); -ms-overflow-style: none; scrollbar-width: none; }
        .category-scroll-container::-webkit-scrollbar { display: none; }
        .category-item { display: inline-block; text-align: center; margin-right: 20px; cursor: pointer; transition: transform 0.2s; }
        .category-item:hover { transform: scale(1.05); }
        .category-circle { width: 70px; height: 70px; border-radius: 50%; background: var(--card-bg); border: 2px solid var(--primary-color); display: flex; align-items: center; justify-content: center; margin: 0 auto 8px auto; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .category-circle i { font-size: 1.8rem; color: var(--primary-color); }
        .category-text { font-size: 0.8rem; font-weight: 600; text-transform: uppercase; }

        /* TARJETAS */
        .card { border: none; background: transparent; }
        .card-img-wrapper { overflow: hidden; position: relative; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .card-img-top { height: 320px; object-fit: cover; transition: transform 0.5s ease; cursor: pointer; }
        .card:hover .card-img-top { transform: scale(1.05); }
        .card-body { padding: 15px 0; text-align: center; }
        .card-title { font-size: 1rem; margin-bottom: 5px; font-weight: 600; }
        .price-tag { font-weight: 400; color: #555; font-size: 1.1rem; display: block; margin-bottom: 8px;}

        /* OFERTAS */
        .offers-title { color: #dc3545; letter-spacing: 2px; font-weight: 700; border-bottom: 2px solid #dc3545; display: inline-block; padding-bottom: 5px; }

        /* ADMIN & FOOTER */
        .admin-panel { border: 2px dashed var(--primary-color); background: #fff; padding: 25px; display: none; margin-bottom: 30px; border-radius: 10px; }
        .delete-btn { position: absolute; top: 10px; right: 10px; background: white; color: red; border: none; border-radius: 50%; width: 30px; height: 30px; z-index: 10; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .footer-section { background-color: white; border-top: 1px solid #eee; padding: 40px 20px; margin-top: 50px; text-align: left; }
        .instagram-btn { background-color: var(--primary-color); color: white; padding: 10px 20px; border-radius: 30px; text-decoration: none; display: inline-flex; align-items: center; font-weight: 600; margin-top: 10px; }
        .whatsapp-float { position: fixed; bottom: 20px; right: 20px; background-color: #25D366; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 100; text-decoration: none; }
    </style>
</head>
<body>

    <img src="decor1.png" class="bg-decoration" style="top: -20px; left: -20px; width: 180px; transform: rotate(-15deg);">
    <img src="decor2.png" class="bg-decoration" style="top: 50px; right: -30px; width: 200px; transform: rotate(20deg);">
    <img src="decor3.png" class="bg-decoration" style="top: 180px; right: 10px; width: 110px; transform: rotate(-10deg);">
    <img src="decor5.png" class="bg-decoration" style="bottom: 15%; right: 5%; width: 180px; transform: rotate(-10deg);">
    <img src="decor4.png" class="bg-decoration" style="bottom: 10%; left: 30%; width: 90px; transform: rotate(25deg);">

    <nav class="navbar sticky-top">
        <div class="container-fluid px-3 d-flex align-items-center justify-content-between">
            <button class="custom-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"><i class="bi bi-list"></i></button>
            <a class="navbar-brand fw-bold" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="mb-1 me-1" viewBox="0 0 16 16" style="color: var(--primary-color);"><path d="M5 16L3 5L8.5 10L12 4L15.5 10L21 5L19 16H5M19 19C19 19.5523 18.5523 20 18 20H6C5.44772 20 5 19.5523 5 19V18H19V19Z" transform="scale(0.7)"/></svg>
                PRETTY ACCESORIOS
            </a>
            <div class="search-container"><input type="text" id="searchInput" class="search-input" placeholder="Buscar..."></div>
        </div>
    </nav>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title fw-bold" style="color: var(--primary-color);">MEN√ö</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item"><a class="nav-link" href="#" onclick="filterProducts('todos'); closeMenu()">Inicio</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex justify-content-between align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                        Productos <i class="bi bi-chevron-down small"></i>
                    </a>
                    <ul class="dropdown-menu border-0 bg-light">
                        <li><a class="dropdown-item" href="#" onclick="filterProducts('ver_todo_absoluto'); closeMenu()">Ver todo</a></li>
                        <li><a class="dropdown-item" href="#" onclick="filterProducts('pulseras'); closeMenu()">Pulseras</a></li>
                        <li><a class="dropdown-item" href="#" onclick="filterProducts('collares'); closeMenu()">Collares</a></li>
                        <li><a class="dropdown-item" href="#" onclick="filterProducts('chokers'); closeMenu()">Chokers</a></li>
                        <li><a class="dropdown-item" href="#" onclick="filterProducts('anillos'); closeMenu()">Anillos</a></li>
                        <li><a class="dropdown-item" href="#" onclick="filterProducts('tobilleras'); closeMenu()">Tobilleras</a></li>
                        <li><a class="dropdown-item" href="#" onclick="filterProducts('cadenitas'); closeMenu()">Cadenitas</a></li>
                    </ul>
                </li>
                <li class="nav-item"><a class="nav-link" href="#contacto" onclick="closeMenu()">Contacto</a></li>
                <li class="nav-item mt-4 pt-4 border-top">
                    <a class="nav-link text-muted small" href="#" onclick="toggleAdmin(); closeMenu()"><i class="bi bi-gear"></i> Soy la Due√±a</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="container-fluid px-0">
        <div class="category-scroll-container text-center">
            <div class="category-item" onclick="filterProducts('pulseras')"><div class="category-circle"><i class="bi bi-gem"></i></div><div class="category-text">Pulseras</div></div>
            <div class="category-item" onclick="filterProducts('collares')"><div class="category-circle"><i class="bi bi-heart"></i></div><div class="category-text">Collares</div></div>
            <div class="category-item" onclick="filterProducts('chokers')"><div class="category-circle"><i class="bi bi-stars"></i></div><div class="category-text">Chokers</div></div>
            <div class="category-item" onclick="filterProducts('anillos')"><div class="category-circle"><i class="bi bi-circle"></i></div><div class="category-text">Anillos</div></div>
            <div class="category-item" onclick="filterProducts('tobilleras')"><div class="category-circle"><i class="bi bi-sun"></i></div><div class="category-text">Tobilleras</div></div>
             <div class="category-item" onclick="filterProducts('cadenitas')"><div class="category-circle"><i class="bi bi-link"></i></div><div class="category-text">Cadenitas</div></div>
        </div>
    </div>

    <div class="container my-4">
        
        <div id="admin-section" class="admin-panel shadow-sm">
            <h4 class="mb-4 text-center" style="color: var(--primary-color);">üëë Cargar Nuevo Producto</h4>
            <form id="product-form" class="row g-3">
                <div class="col-6"><label class="form-label small fw-bold">Nombre</label><input type="text" class="form-control" id="nombre" required></div>
                <div class="col-6"><label class="form-label small fw-bold">Precio ($)</label><input type="number" class="form-control" id="precio" required></div>
                <div class="col-12"><label class="form-label small fw-bold">Categor√≠a</label>
                    <select id="categoria" class="form-select">
                        <option value="pulseras">Pulsera</option><option value="collares">Collar</option><option value="chokers">Choker</option>
                        <option value="anillos">Anillo</option><option value="tobilleras">Tobillera</option><option value="cadenitas">Cadenita</option>
                    </select>
                </div>
                <div class="col-12">
                    <div class="form-check form-switch p-2 border rounded bg-light">
                        <input class="form-check-input ms-0 me-2" type="checkbox" id="esOferta">
                        <label class="form-check-label fw-bold text-danger" for="esOferta">¬øEs Oferta Semanal? üî•</label>
                    </div>
                </div>
                <div class="col-12"><label class="form-label small fw-bold">Foto</label><input type="file" class="form-control" id="foto-file" accept="image/*" required></div>
                <div class="col-12"><label class="form-label small fw-bold">Descripci√≥n</label><textarea class="form-control" id="descripcion" rows="2"></textarea></div>
                <div class="col-12 d-grid">
                    <button type="submit" id="submit-btn" class="btn btn-dark py-2">SUBIR PRODUCTO</button>
                    <div id="loading-msg" class="text-center small mt-2 text-muted" style="display:none;">Cargando... ‚è≥</div>
                </div>
            </form>
        </div>

        <div id="offers-wrapper" class="mb-5" style="display: none;">
            <div class="text-center mb-4">
                <h3 class="offers-title">üî• OFERTAS SEMANALES</h3>
            </div>
            <div id="offers-container" class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3"></div>
        </div>

        <h3 id="section-title" class="text-center mb-4 mt-2">NUESTROS PRODUCTOS</h3>

        <div id="products-container" class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3"></div>
    </div>

    <div id="contacto" class="footer-section">
        <div class="container">
            <div class="row">
                <div class="col-md-6 mb-4">
                    <h5 class="footer-title">CONTACTANOS</h5>
                    <div class="mb-2"><i class="bi bi-telephone text-primary me-2"></i> +5492634670332</div>
                    <div class="mb-2"><i class="bi bi-envelope text-primary me-2"></i> mtzvalennn@gmail.com</div>
                    <div class="mb-2"><i class="bi bi-geo-alt text-primary me-2"></i> San Mart√≠n, Mendoza</div>
                </div>
                <div class="col-md-6 mb-4">
                    <h5 class="footer-title">REDES SOCIALES</h5>
                    <a href="https://www.instagram.com/pretty.accesoriios" target="_blank" class="instagram-btn">
                        <i class="bi bi-instagram me-2"></i> Seguir @pretty.accesoriios
                    </a>
                </div>
                <div class="col-12 mt-3 pt-3 border-top text-center small text-muted">&copy; 2026 Pretty Accesorios</div>
            </div>
        </div>
    </div>

    <a href="https://wa.me/5492634670332?text=Hola!%20Vi%20tu%20pagina%20y%20quiero%20consultarte..." class="whatsapp-float" target="_blank"><i class="bi bi-whatsapp"></i></a>

    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-transparent border-0">
                <div class="modal-body p-0 position-relative text-center">
                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal"></button>
                    <img src="" id="modalImage" class="img-fluid rounded shadow" style="max-height:80vh;">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ==========================================
        // üîë TU CLAVE DE IMGBB
        const IMGBB_API_KEY = "8a2b9037b8733cba6a00b87a07dad307"; 
        // ==========================================

        const firebaseConfig = {
            apiKey: "AIzaSyDqXsi6k9z4aDn46bYCEHylATvNak8ksMs",
            authDomain: "pretty-accesorios.firebaseapp.com",
            projectId: "pretty-accesorios",
            storageBucket: "pretty-accesorios.firebasestorage.app",
            messagingSenderId: "429462250492",
            appId: "1:429462250492:web:007bff7ee95a1e98efc879",
            measurementId: "G-4CY1K9C7GN"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const productsRef = collection(db, "productos");
        
        let isAdmin = false;
        let allProducts = []; 
        let currentCategory = 'todos';

        async function uploadToImgBB(file) {
            const formData = new FormData();
            formData.append("image", file);
            formData.append("key", IMGBB_API_KEY);
            const response = await fetch("https://api.imgbb.com/1/upload", { method: "POST", body: formData });
            const data = await response.json();
            if(!data.success) throw new Error("Error subiendo foto");
            return data.data.url; 
        }

        const createCardHTML = (prod) => {
            return `
                <div class="col">
                    <div class="card h-100">
                        <div class="card-img-wrapper">
                            ${isAdmin ? `<button onclick="window.deleteProduct('${prod.id}')" class="delete-btn">√ó</button>` : ''}
                            <img src="${prod.imagen}" class="card-img-top" alt="${prod.nombre}" onclick="window.showFullImage('${prod.imagen}')">
                        </div>
                        <div class="card-body">
                            <h5 class="card-title text-uppercase">${prod.nombre}</h5>
                            <p class="price-tag mb-2">$${prod.precio}</p>
                            <a href="https://wa.me/5492634670332?text=Hola!%20Quiero%20comprar%20el%20producto:%20${prod.nombre}" 
                               class="btn whatsapp-btn" target="_blank">¬°Lo quiero! üíú</a>
                        </div>
                    </div>
                </div>
            `;
        }

        const renderUI = (regularProducts, offerProducts) => {
            const container = document.getElementById('products-container');
            const offersContainer = document.getElementById('offers-container');
            const offersWrapper = document.getElementById('offers-wrapper');
            
            container.innerHTML = '';
            offersContainer.innerHTML = '';

            // RENDERIZAR OFERTAS (Solo en Inicio)
            if(currentCategory === 'todos' && offerProducts.length > 0) {
                offersWrapper.style.display = 'block';
                offerProducts.forEach(prod => { offersContainer.innerHTML += createCardHTML(prod); });
            } else {
                offersWrapper.style.display = 'none';
            }

            // RENDERIZAR PRODUCTOS
            if(regularProducts.length === 0) {
                if(offerProducts.length === 0) {
                    container.innerHTML = '<div class="col-12 text-center py-5"><p class="text-muted">No se encontraron productos.</p></div>';
                }
                return;
            }
            regularProducts.forEach(prod => { container.innerHTML += createCardHTML(prod); });
        };

        const applyFilters = () => {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            let regularResult = [];
            let offersResult = [];

            if(searchTerm.length > 0) {
                document.getElementById('section-title').innerText = `Resultados para: "${searchTerm}"`;
                document.getElementById('offers-wrapper').style.display = 'none';
                regularResult = allProducts.filter(p => p.nombre.toLowerCase().includes(searchTerm));
            } else {
                offersResult = allProducts.filter(p => p.esOferta === true);

                if(currentCategory === 'todos') {
                    // MODO INICIO (RESUMEN)
                    document.getElementById('section-title').innerText = 'NOVEDADES (RESUMEN)';
                    const counts = {};
                    regularResult = allProducts.filter(p => {
                        const cat = p.categoria;
                        counts[cat] = (counts[cat] || 0) + 1;
                        return counts[cat] <= 2; 
                    });
                } else if (currentCategory === 'ver_todo_absoluto') {
                    // MODO VER TODO (SIN LIMITES)
                    document.getElementById('section-title').innerText = 'TODOS LOS PRODUCTOS';
                    regularResult = allProducts; // Aqu√≠ se muestra todo
                } else {
                    // MODO CATEGOR√çA ESPEC√çFICA
                    document.getElementById('section-title').innerText = currentCategory.toUpperCase();
                    regularResult = allProducts.filter(p => p.categoria === currentCategory);
                }
            }
            renderUI(regularResult, offersResult);
        };

        onSnapshot(productsRef, (snapshot) => {
            allProducts = [];
            snapshot.forEach((doc) => { allProducts.push({ id: doc.id, ...doc.data() }); });
            applyFilters(); 
        });

        document.getElementById('searchInput').addEventListener('input', applyFilters);

        window.filterProducts = (cat) => { 
            currentCategory = cat; 
            document.getElementById('searchInput').value = ''; 
            applyFilters(); 
        }
        window.showFullImage = (url) => { document.getElementById('modalImage').src = url; new bootstrap.Modal(document.getElementById('imageModal')).show(); }
        window.closeMenu = () => { const offcanvasEl = document.getElementById('offcanvasNavbar'); const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl); if(offcanvas) offcanvas.hide(); }
        window.deleteProduct = async (id) => { if(confirm('¬øBorrar?')) await deleteDoc(doc(db, "productos", id)); }
        window.toggleAdmin = () => { if(prompt("Contrase√±a:") === "admin123") { isAdmin = true; document.getElementById('admin-section').style.display = 'block'; applyFilters(); }}

        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit-btn'); const loading = document.getElementById('loading-msg');
            btn.disabled = true; loading.style.display = 'block';
            try {
                const file = document.getElementById('foto-file').files[0];
                if (!file) throw new Error("Falta la foto");
                const url = await uploadToImgBB(file);
                const esOferta = document.getElementById('esOferta').checked;
                await addDoc(productsRef, {
                    nombre: document.getElementById('nombre').value,
                    precio: Number(document.getElementById('precio').value),
                    categoria: document.getElementById('categoria').value,
                    esOferta: esOferta,
                    imagen: url,
                    descripcion: document.getElementById('descripcion').value,
                    fecha: new Date()
                });
                alert('¬°Listo!'); e.target.reset();
            } catch (error) { alert("Error: " + error.message); } 
            finally { btn.disabled = false; loading.style.display = 'none'; }
        });
    </script>
</body>
</html>